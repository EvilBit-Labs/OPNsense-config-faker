# OPNsense Config Faker - AI Coding Assistant Rules

This document outlines the core concepts, framework, and coding standards for the OPNsense Config Faker project. It serves as a comprehensive guide for AI coding assistants to ensure consistency, maintaibility, and adherence to established best practices.

## 1. Core Philosophy

- **OPNsense Configuration Focus**: This project's primary purpose is generating valid OPNsense `config.xml` files with realistic faked data
- **Single Platform Target**: Specifically designed for OPNsense firewall configurations - not a general network configuration tool
- **CSV as Intermediate Format**: CSV generation is an internal implementation detail, not a primary feature
- **Operator-Centric Design**: Built for network operators and automation engineers who need realistic OPNsense test configurations
- **Ethical Development**: Maintain proper boundaries and respect for the original nett-media/opnsense-config-generator project

## 2. Project Structure

```text
/
├── generate_csv.py           # Main script with integrated CSV and XML generation
├── run_generator.sh          # Interactive helper script
├── legacy/                   # Original OPNsense functionality (preserved for reference)
├── opnsense/
│   └── models/              # ⚠️  GENERATED CODE - DO NOT EDIT MANUALLY
├── output/                   # Generated configuration files
├── tests/                    # Test suite (when implemented)
├── justfile                  # Task runner configuration
└── pyproject.toml           # Project metadata and dependencies (uv)
```

### ⚠️ Generated Code Warning

**CRITICAL**: The `opnsense/models/` directory contains code generated from the OPNsense XSD schema using xsdata-pydantic. **Never manually edit files in this directory** as they will be overwritten during model regeneration.

- **Generated by**: `xsdata` command from `opnsense-config.xsd`
- **Regeneration**: Use `just generate-models` or manual xsdata command
- **Customization**: Extend generated models in separate files, don't modify originals
- **Version Control**: Generated files should be committed but never manually edited

## 3. Technology Stack

|| Layer | Technology | Notes |
|| \------------------- | ------------------------------- | ---------------------------------------- |
|| **Language** | Python 3.10+ | Modern Python with type hints |
|| **Data Generation** | Faker | For realistic network configuration data |
|| **XML Processing** | lxml | For OPNsense XML configuration generation|
|| **CLI Framework** | Typer + Rich | Modern CLI with enhanced terminal output |
|| **Testing** | pytest | When test suite is implemented |
|| **Tooling** | `uv` for deps, `just` for tasks | `ruff` for linting and formatting |

## 4. Coding Standards and Conventions

### Python

- **Formatting**: `ruff format` with a line length of 119 characters
- **Linting**: `ruff` to enforce style and catch errors
- **Type Hinting**: Mandatory for all functions and methods. Use modern union types (`str | None`)
- **Naming**: `snake_case` for variables and functions, `CamelCase` for classes
- **Error Handling**: Raise specific, descriptive exceptions with proper context
- **Dependencies**: Manage with `uv`. No `requirements.txt`
- **Documentation**: Clear docstrings for all public functions

### Data Generation Principles

- **Realistic Data**: Generate RFC-compliant network configurations
- **Unique Values**: Ensure no duplicate VLAN IDs or conflicting IP ranges
- **Configurable**: Allow users to specify count, output format, and other parameters
- **Consistent**: Maintain consistent data patterns across generated records

### Commit Messages

- **Conventional Commits**: All commit messages must adhere to the [Conventional Commits](https://www.conventionalcommits.org) specification
  - **Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `perf`, `test`, `build`, `ci`, `chore`
  - **Scopes**: `(cli)`, `(data)`, `(legacy)`, `(docs)`, etc.
  - **Breaking Changes**: Indicated with `!` in the header or `BREAKING CHANGE:` in the footer

## 5. Development Guidelines

### Core Functionality

- **Primary Purpose**: Generate valid OPNsense `config.xml` files with realistic faked data
- **Main Script**: `generate_csv.py` - Tool for OPNsense configuration generation
- **XML Generation**: Primary feature - creates complete OPNsense configurations with realistic test data
- **CSV as Intermediate**: CSV generation is an internal implementation detail for data processing
- **Single Platform**: OPNsense only - not designed for other platforms or output formats
- **CLI Interface**: Simple interface focused on OPNsense configuration generation
- **Internal Data Format**: CSV with columns: VLAN, IP Range, Beschreibung, WAN (used internally)

### Legacy Support and Integration

- **Preservation**: Original OPNsense functionality preserved in `legacy/` directory for reference
- **Integration**: Core XML generation functionality integrated into main tool with proper attribution
- **Modernization**: Legacy code enhanced with modern Python practices, type hints, and error handling
- **Attribution**: All integrated code maintains proper attribution to Stefan Reichhard's original work
- **Upstream Guidance**: Users still encouraged to use upstream project for latest OPNsense-specific features

### Quality Assurance

1. **Code Quality**: All code must pass `ruff` linting and formatting checks
2. **Type Safety**: Comprehensive type hints for all functions
3. **Testing**: Generate valid configurations that can be used in real testing scenarios
4. **Documentation**: Clear documentation for all user-facing functionality
5. **Backwards Compatibility**: Maintain compatibility with existing usage patterns

## 6. AI Assistant Behavior

- **Clarity and Precision**: Be direct, professional, and context-aware in all interactions
- **Adherence to Standards**: Strictly follow the defined rules for code style and project structure
- **Tool Usage**: Use `uv` for dependency management and `just` for task execution
- **Respect Legacy**: Don't modify legacy code unless specifically requested
- **Focus on Value**: Enhance the project's unique value proposition as a network configuration data generator
- **Ethical Boundaries**: Always respect the original project authors and encourage upstream usage where appropriate

## 7. Integrated XML Generation

### Features

- **Complete Integration**: Legacy XML functionality now integrated into main tool
- **Modern CLI**: `python generate_csv.py xml` command for XML generation
- **Core Dependencies**: All required dependencies included by default
- **Attribution Maintained**: All integrated code properly attributed to original author
- **Enhanced Functionality**: Error handling, progress indicators, and validation added

### Usage Examples

```bash
# Primary use case - Generate OPNsense XML configuration
python generate_csv.py xml --base-config config.xml --count 25

# Generate CSV for intermediate processing (rarely needed directly)
python generate_csv.py csv --count 25

# Use existing CSV file for XML generation (advanced usage)
python generate_csv.py xml --base-config config.xml --csv-file my-data.csv
```

## 8. Future Roadmap Considerations

- Comprehensive test suite with pytest
- Enhanced OPNsense configuration elements (additional modules, more realistic data)
- Configuration validation and consistency checking for OPNsense configs
- Enhanced XML template system for different OPNsense versions
- Improved realistic data generation for OPNsense-specific features

**Note**: Supporting other platforms or output formats beyond OPNsense XML is explicitly NOT a feature goal
